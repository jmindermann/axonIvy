<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>Migration Notes Engine</title>
    <link rel="shortcut icon" href="../shared/images/ivy_favicon_48.png" />
    <link href="../shared/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="../shared/css/docs.min.css" rel="stylesheet" type="text/css">
    <link href="../shared/css/ivy-common-6.css" rel="stylesheet" type="text/css">
    <link href="../shared/css/ivy-designer-doc.css" rel="stylesheet" type="text/css">
    <script src="../shared/js/jquery.min.js"></script>
    <script src="../shared/js/bootstrap.min.js"></script>
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <div id="mainContent">

      <!-- start-top-navigation -->
      <div class="navbar navbar-top" role="navigation">
        <div class="container" id="headerdiv">
          <div class="navbar-header">
            <a class="ivy-logo" href="http://developer.axonivy.com">
              <img src="../shared/images/axon_ivy_logo.png" alt="Axon.ivy" />
            </a>
          </div>
          <div class="navbar">
            <ul class="nav nav-pills" id="navbar-ivy-links">
              <li><a href="http://developer.axonivy.com/download/" target="blank"><span class="glyphicon glyphicon-download" aria-hidden="true"></span><br>Download</a></li>
              <li><a href="http://developer.axonivy.com/doc/" target="blank"><span class="glyphicon glyphicon-book" aria-hidden="true"></span><br>Documentation</a></li>
              <li><a href="http://answers.axonivy.com" target="blank"><span class="glyphicon glyphicon-user" aria-hidden="true"></span><br>Q &amp; A</a></li>
              <li><a href="http://www.ivyteam.ch/flatpress/?paged=1" target="blank"><span class="glyphicon glyphicon-new-window" aria-hidden="true"></span><br>Blog</a></li>
            </ul>
          </div>
        </div><!-- /.container -->
      </div>
      <div class="navbar ivy-subnav">
        <div class="navbar-inner">
          <div class="container">
            <div class="row">
              <ul class="nav nav-pills">
                <li><a href="../newAndNoteworthy/NewAndNoteworthyDesigner.html">N&amp;N Designer</a></li>
                <li><a href="../newAndNoteworthy/NewAndNoteworthyEngine.html">N&amp;N Engine</a></li>
                <li><a href="../../ReleaseNotes.txt">Realease Notes</a></li>
                <li class="active"><a href="../../MigrationNotes.html">Migration Notes</a></li>
                <li><a href="../../ReadMe.html">Read Me</a></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <!-- end-top-navigation -->

      <div class="container">
        <h1 class="page-header">Migration Notes for Axon.ivy Engine 7.0 (Jakobshorn)</h1>

        <p>This document informs you in detail <strong>how to migrate the data and
        projects of an existing Axon.ivy Engine 6.0 (SÃ¤ntis) installation</strong> to a new Axon.ivy Engine 7.0 (Jakobshorn)
        installation. </p>

        <div class="bs-callout bs-callout-warning">
          When migrating an Axon.ivy Engine it may also be necessary to convert the deployed projects.
          Specially, if your projects are using HTML Dialogs with Primefaces. 
          Therefore, also read the <a href="MigrationNotesDesigner.html">Designer Migration Notes</a> before migrating the engine.</div>
        <p>Table of Content:</p>
        <ul style="margin-bottom: 30px;">
          <li><a href="#newlic">New engine license</a></li>
          <li><a href="#osgi">OSGi engine</a>
            <ul>
              <li><a href="#Extensions">Axon.ivy Extensions</a></li>
              <li><a href="#tomcatValve">Tomcat valve</a></li>
            </ul>
          </li>
          <li><a href="#supportedDbs">Supported Databases</a></li>
          <li><a href="#systemDatabaseCreation">System Database creation, character set and collation</a></li>
          <li><a href="#linux-service">Linux service based on systemd</a></li>
          <li><a href="#portal">Portal</a></li>
          <li><a href="#sessionAttributes">Session attributes cleaned after user logs out</a></li>
          <li><a href="#wfPermissions">Workflow Permissions</a></li>
          <li><a href="#taglib">JSP Taglibraries</a></li>
          <li><a href="#Theme">Primefaces Themes</a></li>
          <li><a href="#projectDep">Project dependencies</a></li>
          <li><a href="#pmvStates">Process Model Version activity and release state</a></li>
          <li><a href="#riaClientlib">RIA client libraries</a></li>
          <li><a href="#deprecatedPublicAPI">Removal of deprecated Public API</a></li>
          <li><a href="#businessData">Business Data</a>
            <ul>
              <li><a href="#formatMigration">Format migration required</a></li>
              <li><a href="#elasticsearch">Elasticsearch server</a></li>
              <li><a href="#elasticsearch-index-migration">Elasticsearch index migration</a></li>
            </ul>
          </li>
        </ul>

        <hr/>

        <div class="bs-callout bs-callout-warning">
          <h3><a id="newlic"></a>New engine license required</h3>
          <div class="leadingEdgeNotice">Migration needed for all versions</div>
          <p>The Axon.ivy Engine 7.0 requires a new license. Please contact your sales agent to upgrade your license.</p>
          <p>The section "Installing a Licence" in the Installation chapter of the Engine Guide describes how to install a new license.</p>
          <br>
        </div>

        <hr/>

        <h3><a id="osgi"></a>OSGi engine</h3>
        <div class="leadingEdgeNotice">Migration needed for all versions</div>
        <p>The Axon.ivy Engine now runs in OSGi mode by default. This means that the runtime environment of an OSGi based Engine and a Designer is now nearly the same,
        which should reduce the amount of class loading problems significantly.</p>

        <h4><a id="Extensions"></a>Axon.ivy Extensions (*.extensions file deprecated)</h4>
        <p>Like Axon.ivy Designer the Engine now also supports the Eclipse extension point mechanism.
        Therefore, extensions can be registered in the plugin.xml that is located in your Axon.ivy extension bundle (*.jar file).
        It is no longer necessary to write a *.extensions file and put it into the configuration/extensions directory.</p>
        <p>Old Axon.ivy extensions with a *.extensions file still work but are deprecated.
        We suggest to refactor Axon.ivy extensions to use the plugin.xml file instead.
        Support for *.extensions file will be removed in future versions.</p>

        <h4><a id="tomcatValve"></a>Tomcat valve</h4>
        <p>A custom Tomcat valve, that is used to authenticate your users, must be made accessible to the Axon.ivy OSGi environment.
        Basically the JAR that provides this valve needs additional OSGi headers in its manifest. In the Axon.ivy Engine Guide there
        is a new chapter that explains how you can provide your valve extension so that it can be used by the Tomcat in Axon.ivy:</p>
        <p>See <i>Engine Guide &gt; Configuration &gt; Configure Tomcat &gt; Custom Valve</i></p>

        <hr />

        <h3><a id="supportedDbs"></a>Supported Databases</h3>
        <div class="leadingEdgeNotice">Migration <b>not</b> needed for <span class="feature-badge">6.4</span>..<span class="feature-badge">7.0</span></div>
        <p>With this release some old and rarely used databases are no longer supported. We dropped the database support for <code>Sybase SqlAnywhere</code> and <code>IBM DB2 LUW</code>.</p>
        <p>The list of supported System Databases can be found in the Engine Guide:<br/>
        See <i>Engine Guide &gt; Configuration &gt; Engine Configuration &gt; System Database</i></p>

        <p>We also removed the bundled JDBC driver for these products so they are no longer usable as external database out of the box.
        But it is still possible to add your own JDBC driver to the classpath by copying it to <code>jre/lib/ext</code>.</p>

        <hr/>

        <h3><a id="systemDatabaseCreation"></a>System Database creation, character set and collation</h3>
        <div class="leadingEdgeNotice">Migration <b>not</b> needed for <span class="feature-badge">6.6</span>..<span class="feature-badge">7.0</span></div>
        <p>You have now the possibility to previously create an empty Axon.ivy system database. In this case the server configuration tool will only create the necessary tables into the given database.</p>
        <p>
            Additionally, in the Axon.ivy Engine Guide (Configuration / System Database) you will find some basic notes about character set and collation and how you can change them.
            The character set and collation influence which languages (e.g. Chinese characters) are support and how the database queries work (case insensitive).
        </p>

        <hr/>

        <h3><a id="linux-service"></a>Linux service based on systemd</h3>
        <div class="leadingEdgeNotice">Migration <b>not</b> needed for <span class="feature-badge">6.5</span>..<span class="feature-badge">7.0</span></div>
        <p>The scripts to run the Axon.ivy Engine as a service under Linux are now based on systemd (<code>AxonIvyEngine.service</code>).</p>
        <p>Please install the new service by starting <code>./InstallService.sh</code> as root in the <code>bin/</code> directory of your Engine.</p>
        <p>Remove the old init.d service found under <code>/etc/init.d/AxonIvyEngineService</code>.</p>
        <p>See <i>Engine Guide > Miscellaneous > Tool Reference > InstallService</i> for more information.</p>

        <hr/>

        <h3><a id="portal"></a>Portal</h3>
        <div class="leadingEdgeNotice">Migration needed for all versions</div>
        <p>The Portal application that is bundled with the Engine has been improved in many areas. If you have customized the Portal please refer to the chapter <i><a href="http://developer.axonivy.com/doc/6.4.latest/PortalKitHtml/axonivyportal.installation.html#axonivyportal-installation-migrationnotes">Migration Notes</a></i> in the <i>PortalKit</i> Documentation.</p>

        <hr />

        <h3><a id="sessionAttributes"></a>Session attributes cleaned after user logs out</h3>
        <div class="leadingEdgeNotice">Migration <b>not</b> needed for <span class="feature-badge">6.4</span>..<span class="feature-badge">7.0</span></div>
        <p>Session attributes are cleaned after the logout of a user. Projects should not depend on values stored in a session after a logout.</p>

        <hr/>

        <h3><a id="wfPermissions"></a>Workflow Permissions</h3>
        <div class="leadingEdgeNotice">Migration <b>not</b> needed for <span class="feature-badge">6.5</span>..<span class="feature-badge">7.0</span></div>
        <p>To change the expiry date of a Task previously the permission <code>TaskWriteExpiry<b>Activator</b></code> was needed, now the new permission <code>TaskWriteExpiry<b>Timestamp</b></code> is needed.</p>
        <p>Assign the permission <code>TaskWriteExpiryTimestamp</code> to users and roles that should have the ability to change the expiry date of a task.</p>

        <hr/>

        <h3><a id="taglib"></a>JSP Taglibraries</h3>
        <div class="leadingEdgeNotice">Migration <b>not</b> needed for <span class="feature-badge">6.2</span>..<span class="feature-badge">7.0</span></div>
        <p>Taglibraries for JSP  are no longer loaded and used by the Tomcat webserver if they are on the classpath of an IvyProject.
        Instead only taglibraries within the <code>webapps/ivy/WEB-INF/lib</code> folder is used.<br>Since most JSP implementors only use the  standard JSTL  1.2 taglibrary, it is now included in the <code>WEB-INF/lib</code> directory by default.</p>

        <hr/>

        <h3><a id="Theme"></a>Primefaces Theme</h3>
        <div class="leadingEdgeNotice">Migration <b>not</b> needed for <span class="feature-badge">6.1</span>..<span class="feature-badge">7.0</span></div>
        <p>If you have configured a Primefaces theme in the file <code>webapps/ivy/WEB-INF/web.xml</code> and want to use the new feature to set the Primeface theme per application then you have to change the <code>web.xml</code> file as follows:</p>
        <p>Change the following entry in the old <code>web.xml</code>:</p>
        <pre><code>&lt;context-param&gt;
  &lt;param-name&gt;primefaces.THEME&lt;/param-name&gt;
  &lt;param-value&gt;<b>le-frog</b>&lt;/param-value&gt;
&lt;/context-param&gt;</code></pre>
        <p>to</p>
        <pre><code>&lt;context-param&gt;
  &lt;param-name&gt;primefaces.THEME&lt;/param-name&gt;
  &lt;param-value&gt;<b>#{ivyPrimefacesThemeResolver.getTheme('le-frog')}</b>&lt;/param-value&gt;
&lt;/context-param&gt;</code></pre>

        <hr />

        <h3><a id="projectDep"></a>Project dependencies</h3>
        <div class="leadingEdgeNotice">Migration <b>not</b> needed for <span class="feature-badge">6.1</span>..<span class="feature-badge">7.0</span></div>
        <p>In Axon.ivy 6.0 the project versions <code>1.0.0</code> and <code>1.0.0-SNAPSHOT</code> were treated as equal.
          With the change to the new version format in Axon.ivy 6.1 the versions are treated as in maven.
          This means the version (e.g. <code>1.0.0</code>) is greater than the SNAPSHOT version (e.g. <code>1.0.0-SNAPSHOT</code>).
          A project deployed previously of Axon.ivy 6.1 with a version of <code>7</code> now shows up as <code>7-SNAPSHOT</code>.</p>

        <hr/>

        <h3><a id="pmvStates"></a>Process Model Version activity and release state</h3>
        <div class="leadingEdgeNotice">Migration <b>not</b> needed for <span class="feature-badge">6.4</span>..<span class="feature-badge">7.0</span></div>
        <p>Earlier a process model version was put to the release state <code>ARCHIVED</code> if it had no running cases.
           Now, a process model version is only put to the release state <code>ARCHIVED</code> if it has no running cases and all process model versions that are using it over project dependencies are also in state <code>ARCHIVED</code>.
           This ensures that a process model version in state <code>ARCHIVED</code> is nowhere used and therefore resources can be saved because it's project files do not have to be loaded and started.</p>
        <p>Earlier a process model version had an activity state <code>ACTIVE</code> if the process model version and it's process model and application had a configured <code>ACTIVE</code> activity state .
           Now, a process model version has only an activity state <code>ACTIVE</code> if additionally also the release state is <code>RELEASED</code> or <code>DEPRECATED</code>.
           A process model version in release state <code>PREPARED</code>, <code>ARCHIVED</code> or <code>DELETED</code> can therefore never be <code>ACTIVE</code>.
           This means the activity state now correspond to the state of the process engine and therefore better shows what is going on inside the engine.</p>
        <p>Now, during engine startup, only process model versions that can be brought to state <code>ACTIVE</code> are started. In Axon.ivy 6.3 and earlier all process model version were started during engine startup independent of their activity and release states.</p>

        <hr/>

        <h3><a id="riaClientlib"></a>RIA client libraries</h3>
        <div class="leadingEdgeNotice">Migration <b>not</b> needed for <span class="feature-badge">6.5</span>..<span class="feature-badge">7.0</span></div>
        <p>The engine does no longer contain the compressed pack200 webstart libraries for Rich Dialog applications.
        The normal client libraries packed as jar are still available. So any Rich Dialog application runs out of the box.</p>
        <p>If your application contains mainly Rich Dialogs you can still enable pack200 client libraries in order to save network bandwidth.
        To do so you have to run a script in the commandline that will create the pack200 libararies in pack.gz format.</p>
        <p>For more information see <i>Engine Guide &gt; Miscellaneous &gt; Rich Dialogs &gt; Compressed Client Libraries</i></p>

        <hr />

        <h3><a id="deprecatedPublicAPI"></a>Removal of deprecated Public API</h3>
        <div class="leadingEdgeNotice">Migration <b>not</b> needed for <span class="feature-badge">6.1</span>..<span class="feature-badge">7.0</span></div>
        <p>The following Public API has been removed:</p>
        <ul>
          <li><code>ivyteam.cs.webapp.pi.ConfigurationEditor</code></li>
        </ul>
        <p>It was marked as deprecated for several years.
        The API was used for programmable process elements (Program Start Event, Program Intermediate Event, Program Interface Activity).
        Bean implementations using this class must be rewritten to use the new editor class <code>ch.ivyteam.ivy.process.extension.impl.AbstractProcessExtensionConfigurationEditor</code>.</p>

        <hr/>

        <h3><a id="businessData"></a>Business Data</h3>
        <div class="leadingEdgeNotice">Migration <b>only</b> needed for <span class="feature-badge">6.3</span>..<span class="feature-badge">7.0</span></div>

        <h4><a id="formatMigration"></a>Format migration required</h4>
        <p>The stored JSON format of the Business Data values has been changed. Therefore, Business Data values, written with a previous version, are no longer accessible with the BusinessDataRepository until they are explicitly migrated.</p>
        <p>To migrate your stored Business Data to the latest version you must add a new process in your ivy project that owns the root Business Data class.
           This process should call <a href="http://developer.axonivy.com/doc/latest/PublicAPI/index.html?ch/ivyteam/ivy/business/data/store/migration/BusinessDataJsonFormatMigrator.html">ch.ivyteam.ivy.business.data.store.migration.BusinessDataJsonFormatMigrator.migrate(com.workflow.MyBusinessData.class, false)</a> in a script activity.
           Re-deploy the project and start an instance of this process to apply the migration. Ensure that you call the migration method for each root Business Data classes of your application.</p>
        <p>See <i>WorkflowDemos &gt; Processes &gt; BusinessData &gt; MigrateData</i> for an example</p>

        <hr/>

        <h4><a id="elasticsearch"></a>Elasticsearch server</h4>
        <p>Axon.ivy Engine now requires an Elasticsearch server 5.5.x. If you run an Axon.ivy Standard Edition the bundled Elasticsearch server is used and no additional setup steps are required.
           If you migrate an Axon.ivy Enterprise Edition you have to setup an external Elasticsearch server and configure the connection in Axon.ivy Engine.
           If you already have used an external Elasticsearch server migrate it to 5.5.x before migrating Axon.ivy to 6.7 or higher.</p>
        <p>See <i>Help &gt; Engine Guide &gt; Installation &gt; Elasticsearch Installation</i></p>

        <hr/>

        <p>Prior to 6.7 the Java vm arguments used to start the bundled Elasticsearch server were stored in the system property <code>Elasticsearch.BundledServer.JavaVmArguments</code>.
           Since 6.7 they are now stored in the file <code>elasticsearch/config/jvm.options</code> and the system property was removed.</p>
        <p>If you have configured other values than the default then reapply the changes in the <code>jvm.options</code> file.</p>

        <hr/>

        <h4><a id="elasticsearch-index-migration"></a>Elasticsearch index migration</h4>
        <p>If an Elasticsearch index exists that has been created with a previous Axon.ivy Engine version (6.7 and later) the pre-existing index can be copied.</p>
        <p>To reuse the pre-existing index simply copy <code>elasticsearch/data/</code> directory from the currently installed engine to the same directory in the new Engine installation.<p>
        <p>If no Elasticsearch index is copied or the index has an old version, the index is re-created on the first engine startup after the migration.</p>

        <hr/>
        
        <h3>JVM Route Ids have changed</h3>
        <div class="leadingEdgeNotice">Only affects Engine Enterprise Edition installations</div>
        <p>The JVM Route Ids of the cluster nodes have changed and need to be adjusted accordingly if they were specified in the <code>workers.properties</code>
        of the load balancer. See: <a href="https://developer.axonivy.com/doc/latest/EngineGuideHtml/integration.html#integration-ivyclusterserver">Load Balancing with Tomcat connector</a></p>

        <hr/>

      </div>
    </div>
  </body>
</html>
